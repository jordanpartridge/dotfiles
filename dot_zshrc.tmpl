# Cross-platform zshrc - managed by chezmoi
# Works on: Nobara Linux, macOS

# --- PATH Setup ---
export PATH="$HOME/.local/bin:$PATH"
export PATH="$HOME/.cargo/bin:$PATH"
{{- if eq .chezmoi.os "darwin" }}
# Homebrew (macOS)
eval "$(/opt/homebrew/bin/brew shellenv)"
{{- end }}

# --- Starship Prompt ---
eval "$(starship init zsh)"

# --- Modern CLI Aliases ---
alias ls='eza --icons --group-directories-first'
alias ll='eza -la --icons --group-directories-first'
alias la='eza -a --icons --group-directories-first'
alias tree='eza --tree --icons'
alias cat='bat'
alias find='fd'

# --- Git Shortcuts ---
alias g='git'
alias gs='git status'
alias gd='git diff'
alias gl='git log --oneline -20'
alias gp='git push'
alias lg='lazygit'

# --- Zinit Plugin Manager ---
ZINIT_HOME="${HOME}/.local/share/zinit/zinit.git"
if [[ ! -d "$ZINIT_HOME" ]]; then
    mkdir -p "$(dirname $ZINIT_HOME)"
    git clone https://github.com/zdharma-continuum/zinit.git "$ZINIT_HOME"
fi
source "${ZINIT_HOME}/zinit.zsh"

# Essential plugins
zinit light zsh-users/zsh-syntax-highlighting
zinit light zsh-users/zsh-autosuggestions
zinit light zsh-users/zsh-completions

# --- FZF Keybindings ---
# Ctrl+R = history search, Ctrl+T = file search
{{- if eq .chezmoi.os "darwin" }}
source "$(brew --prefix)/opt/fzf/shell/key-bindings.zsh" 2>/dev/null
source "$(brew --prefix)/opt/fzf/shell/completion.zsh" 2>/dev/null
{{- else }}
source /usr/share/fzf/shell/key-bindings.zsh 2>/dev/null
source /usr/share/fzf/shell/completion.zsh 2>/dev/null
{{- end }}

# --- History ---
HISTSIZE=10000
SAVEHIST=10000
HISTFILE=~/.zsh_history
setopt appendhistory sharehistory hist_ignore_dups hist_ignore_space

# --- Completion ---
autoload -Uz compinit && compinit
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Za-z}'

# --- Directory Navigation ---
setopt autocd autopushd pushdignoredups
alias ..='cd ..'
alias ...='cd ../..'

# --- Local overrides (not in git) ---
[[ -f ~/.zshrc.local ]] && source ~/.zshrc.local
